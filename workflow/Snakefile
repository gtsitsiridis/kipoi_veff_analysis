import pathlib

assert len(config) > 0, "The config file has not been defined or is empty"

output_path = pathlib.Path(config["output_path"])

# load additional configurations
if config.get('configs',None):
    for conf in config["configs"]:
        print(conf)
        configfile: conf
del config['configs']


module benchmark_workflow:
    snakefile: "rules/benchmark.smk"
    config: config

use rule benchmark from benchmark_workflow


def vcfs(vcf_key):
    # extract name from vcf file
    return [f.name for f in pathlib.Path(config["vcfs"][vcf_key]["path"]).glob('*.vcf.gz')]


def enformer_runs():
    return list(config['runs']['enformer'].keys())


rule all:
    default_target: True
    input: expand(rules.benchmark.output,predictor='enformer',run_key=enformer_runs())
    output: output_path / 'config.yaml'
    script: 'scripts/write_config.py'
